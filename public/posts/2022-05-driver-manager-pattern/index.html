<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Manager and Driver Pattern - pattern, implementation, and usage &#183; Philodev Blog</title><meta name=title content="Manager and Driver Pattern - pattern, implementation, and usage &#183; Philodev Blog"><meta name=description content="The thoughts and ideas of a Code Wizard about coding, development process and self improvement"><link rel=canonical href=https://www.blog.philodev.one/posts/2022-05-driver-manager-pattern/><link type=text/css rel=stylesheet href=/css/main.bundle.min.ce7ac3a2dfb6aeeaaf7af8b3d2ae43a45850a195019f29228612b1f82bd35b9f3eaf446031b06dc18c8791e1284843348330de9a10d78a7026a197791ebd3703.css integrity="sha512-znrDot+2ruqveviz0q5DpFhQoZUBnykihhKx+CvTW58+r0RgMbBtwYyHkeEoSEM0gzDemhDXinAmoZd5Hr03Aw=="><script type=text/javascript src=/js/appearance.min.12e98742cd283574d030a7fe55f29597df4ee214f7ff7075b4d19a64d046a602753c715295550be7899b661619cec89c679049d36c624681671a8013c1249896.js integrity="sha512-EumHQs0oNXTQMKf+VfKVl99O4hT3/3B1tNGaZNBGpgJ1PHFSlVUL54mbZhYZzsicZ5BJ02xiRoFnGoATwSSYlg=="></script>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Manager and Driver Pattern - pattern, implementation, and usage"><meta property="og:description" content="Driver-based Development is a coding pattern that is common in the Laravel world and used in multiple instances in the framework. It's important to understand how Drivers and Managers work to understand how the framework solves some problems, but it's also a nice pattern to keep in mind for example to write tests that usually work with third-party APIs"><meta property="og:type" content="article"><meta property="og:url" content="https://www.blog.philodev.one/posts/2022-05-driver-manager-pattern/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-22T08:13:44+02:00"><meta property="article:modified_time" content="2022-05-22T08:13:44+02:00"><meta property="og:site_name" content="Philodev Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Manager and Driver Pattern - pattern, implementation, and usage"><meta name=twitter:description content="Driver-based Development is a coding pattern that is common in the Laravel world and used in multiple instances in the framework. It's important to understand how Drivers and Managers work to understand how the framework solves some problems, but it's also a nice pattern to keep in mind for example to write tests that usually work with third-party APIs"><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Manager and Driver Pattern - pattern, implementation, and usage","headline":"Manager and Driver Pattern - pattern, implementation, and usage","description":"Driver-based Development is a coding pattern that is common in the Laravel world and used in multiple instances in the framework. It\u0027s important to understand how Drivers and Managers work to understand how the framework solves some problems, but it\u0027s also a nice pattern to keep in mind for example to write tests that usually work with third-party APIs","abstract":"Driver-based Development is a coding pattern that is common in the Laravel world and used in multiple instances in the framework.","inLanguage":"en","url":"https:\/\/www.blog.philodev.one\/posts\/2022-05-driver-manager-pattern\/","author":{"@type":"Person","name":"Sofia Fischer"},"copyrightYear":"2022","dateCreated":"2022-05-22T08:13:44\u002b02:00","datePublished":"2022-05-22T08:13:44\u002b02:00","dateModified":"2022-05-22T08:13:44\u002b02:00","mainEntityOfPage":"true","wordCount":"1585"}]</script><meta name=author content="Sofia Fischer"><link href=mailto:sofia@philodev.com rel=me><link href=https://www.philodev.one rel=me><link href=https://github.com/sofia-fischer rel=me><link href=https://www.linkedin.com/in/sofia-fischer-58b1611b9/ rel=me></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0" href=#main-content><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral print:hidden"><div><a href=/><img src=/logo.png width=1012 height=1012 class="max-w-[10rem] max-h-[10rem] object-scale-down object-left" alt="Philodev Blog"></a></div><nav><ul class="flex flex-col list-none sm:flex-row"><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/posts/ title=Posts>Blog</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=https://www.philodev.one title>About Philodev</a></li><li class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" href=/tags/ title=Tags>Tags</a></li></ul></nav></header><div class=relative><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Philodev Blog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2022-05-driver-manager-pattern/>Manager and Driver Pattern - pattern, implementation, and usage</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Manager and Driver Pattern - pattern, implementation, and usage</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-05-22 08:13:44 +0200 CEST">22 May 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">8 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert"><div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last"><div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden"><details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3"><summary class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700">Table of Contents</summary><div class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#manager-and-driver-pattern-ad-other-patterns>Manager and Driver Pattern (ad other Patterns)</a><ul><li><a href=#builder-pattern>Builder Pattern</a></li><li><a href=#provider-pattern>Provider Pattern</a></li><li><a href=#factory-pattern>Factory Pattern</a></li><li><a href=#the-driver-pattern-in-contrast-to-all-of-them>The Driver Pattern in contrast to all of them</a></li></ul></li><li><a href=#when-to-use-a-driver-manager-solution>When to use a Driver Manager Solution</a></li><li><a href=#implementation>Implementation</a><ul><li><a href=#folder-structure>Folder Structure</a></li><li><a href=#facade>Facade</a></li><li><a href=#manager>Manager</a></li><li><a href=#driver>Driver</a></li><li><a href=#additional>Additional</a></li></ul></li><li><a href=#happy-coding>Happy Coding</a></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose"><div class="!mb-9 text-xl lead">Driver-based Development is a coding pattern that is common in the Laravel world and used in multiple instances in the
framework. It&rsquo;s important to understand how Drivers and Managers work to understand how the framework solves some
problems, but it&rsquo;s also a nice pattern to keep in mind for example to write tests that usually work with third-party
APIs</div><h2 id=manager-and-driver-pattern-ad-other-patterns class="relative group">Manager and Driver Pattern (ad other Patterns) <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#manager-and-driver-pattern-ad-other-patterns aria-label=Anchor>#</a></span></h2><p>I started the research for this post to learn more about the software patterns. After my last learning on the usage of
the Repository Pattern in <a href=https://www.blog.philodev.one/posts/2022-05-custom-query-builder-pattern/>this post</a> about something similar
to the Repository Pattern. So to keep this from happening, I want to give a small overview of the patterns that crossed
my research path. This resulted in some learning, some confusion, and a somewhat understanding of the different patterns
that people associated with the Driver Pattern. Keep in mind, in the end, Software Patterns are proven concepts that
solve common problems in programming.</p><p><figure><img class="my-0 rounded-md" srcset="/images/2022-05-patterns_huc55a63462c8d86d72c0291556247450f_1043859_330x0_resize_box_3.png 330w,
/images/2022-05-patterns_huc55a63462c8d86d72c0291556247450f_1043859_660x0_resize_box_3.png 660w,
/images/2022-05-patterns_huc55a63462c8d86d72c0291556247450f_1043859_1024x0_resize_box_3.png 1024w,
/images/2022-05-patterns_huc55a63462c8d86d72c0291556247450f_1043859_1320x0_resize_box_3.png 2x" src=/images/2022-05-patterns_huc55a63462c8d86d72c0291556247450f_1043859_660x0_resize_box_3.png alt="Why do I care for Software Patterns?"></figure></p><h3 id=builder-pattern class="relative group">Builder Pattern <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#builder-pattern aria-label=Anchor>#</a></span></h3><p>The Builder Pattern enables the build-up of complex objects, the most common example would be the ORM Eloquent. Every
Laravel developer has used it to build the complex object representation of a SQL query. Another example are Laravel
Factories, which also use a number of methods to create a complex object in a readable way. I
recommend <a href=http://snags88.github.io/builder-pattern-in-laravel>this post to learn more</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$users</span> <span class=o>=</span> <span class=nx>User</span><span class=o>::</span><span class=na>factory</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>has</span><span class=p>(</span><span class=nx>Post</span><span class=o>::</span><span class=na>factory</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>count</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>suspended</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>make</span><span class=p>();</span>
</span></span></code></pre></div><h3 id=provider-pattern class="relative group">Provider Pattern <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#provider-pattern aria-label=Anchor>#</a></span></h3><p>The Provider Pattern has more definitions than I expected&mldr; It can refer to the Data Provider pattern I used in Flutter
and Angular to store and hold data; it may refer to the encapsulation of methods that do different things like a plugin
or STK; or in the Laravel world Provider refer to application bootstrapping and configuration, they register routes,
singletons, or bind listeners to events. I recommend asking the person who mentioned it to explain to what they refer.</p><h3 id=factory-pattern class="relative group">Factory Pattern <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#factory-pattern aria-label=Anchor>#</a></span></h3><p>The Factory Pattern (not Laravel Factories!) enables the creation of various types of objects on runtime. The decision
on which precise class to create is done during runtime, but usually the same in different environments. It can be
powerful if you don&rsquo;t know which type of object to create, e.g. if the client may decide this; or you want to have the
creation of multiple objects in one class to localise them or share functions they both need. I
recommend <a href=https://www.sitepoint.com/understanding-the-factory-method-design-pattern/>this post to learn more</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>ProductFactory</span><span class=o>::</span><span class=na>build</span><span class=p>(</span><span class=s1>&#39;Computer&#39;</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=the-driver-pattern-in-contrast-to-all-of-them class="relative group">The Driver Pattern in contrast to all of them <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#the-driver-pattern-in-contrast-to-all-of-them aria-label=Anchor>#</a></span></h3><p>Different Drivers enable different implementations to perform the same tasks. The most common example is sending
messages using different services. A driver could be <code>sms</code>, one <code>mail</code>, and one <code>push notification</code>. The task is always
sending the message to the given set of users, but the implementation is different, other third-party APIs might be used
and sometimes the decision of which driver to use is done on runtime. Another example in the Laravel world is the Cache
Driver that stores your cache in <code>redis</code> or <code>table</code>, or the Database Driver that translates your Eloquent to <code>mySql</code>
or <code>pgsql</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>Message</span><span class=o>::</span><span class=na>channel</span><span class=p>(</span><span class=s1>&#39;mail&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>to</span><span class=p>(</span><span class=nv>$user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>content</span><span class=p>(</span><span class=s1>&#39;Do not think about pink elephants&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>send</span><span class=p>();</span>
</span></span></code></pre></div><p>Now about the different Patterns: This code utilizes the Builder Pattern to set the properties of the object step by
step, but the Driver Pattern Magic happens just in the first line which determines how the message is sent. In the
Driver class itself somewhere the implementation of the sending must be, and there I would call some Service class or
library for actually sending emails and another one for sending SMS. The Factory Pattern might look similar at first
sight as it also creates an object on runtime based on a string, but the Factory Pattern aims to instantiate Models
while the Driver Pattern aims to instantiate classes that offer defined functionalities.</p><h2 id=when-to-use-a-driver-manager-solution class="relative group">When to use a Driver Manager Solution <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#when-to-use-a-driver-manager-solution aria-label=Anchor>#</a></span></h2><p>The most common answer to this question I found was:</p><blockquote><p>A driver-based service is the right choice when the same utility can be provided by more than one technology.
<a href=https://inspector.dev/how-to-extend-laravel-with-driver-based-services/>Source</a></p></blockquote><p>So whenever you discover a problem that might now (or in the future) be solved by multiple or changing technologies,
this pattern can make it easy and simple to switch between the technologies depending on runtime decisions, database
entries, or environment variables.</p><p><strong>But there is more</strong>! I want to emphasize two other options when this pattern can be a handy tool:</p><p><strong>Testing and local development</strong> can be a non-trivial task if you use third-party APIs or your own Micro Services.
During tests (and sometimes during local development) you don&rsquo;t care about the correctness of the technology you are
using, and maybe don&rsquo;t even want to trigger any outside communication. Based on your Environment (<code>testing</code> or <code>local</code>)
you can then switch to a FakerDriver that maybe can be configured in the test to simulate a long request, a wrong
answer, or just correct behavior.</p><p><strong>A-B Testing of Services</strong> The first time I came in contact with this pattern, one of the reasons (besides many others)
why we went for this pattern was the easy implementation of an A-B Test of a new Recommendation System. In a situation
in which you have two technologies to do the same job, but want to compare how the users react to both of them you can
implement a Driver pattern to let different users use different technologies and compare the individual engagement rate
of features for different user groups.</p><h2 id=implementation class="relative group">Implementation <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#implementation aria-label=Anchor>#</a></span></h2><h3 id=folder-structure class="relative group">Folder Structure <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#folder-structure aria-label=Anchor>#</a></span></h3><p>Here is the plan: The two Driver are <code>FakeDriver</code> and <code>HugoDriver</code> (No need to search for that name, I just made it up).
To ensure the next developer who implements a Driver will implement everything we need, the <code>RecommenderContract</code>
defines which methods should be in a Driver. The <code>RecommenderManager</code> is the file in which we define which string causes
the instantiation of which Driver, and which Driver is the Default. And the <code>Recommender</code> is the Facade we will be using
in practice.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Support
</span></span><span class=line><span class=cl>└─── Drivers
</span></span><span class=line><span class=cl>│   │   RecommenderContract.php
</span></span><span class=line><span class=cl>│   │   FakeDriver.php
</span></span><span class=line><span class=cl>│   │   HugoDriver.php
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>└─── Facades
</span></span><span class=line><span class=cl>│   │   Recommender.php
</span></span><span class=line><span class=cl>│
</span></span><span class=line><span class=cl>└─── Managers
</span></span><span class=line><span class=cl>    │   RecommenderManager.php
</span></span></code></pre></div><p>To now understand the implementation I would like to follow the code starting with the usage I aim for.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1>// using default driver
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Recommender</span><span class=o>::</span><span class=na>recommendationsForUser</span><span class=p>(</span><span class=nv>$user</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// using custom driver
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Recommender</span><span class=o>::</span><span class=na>driver</span><span class=p>(</span><span class=s1>&#39;hugo&#39;</span><span class=p>)</span><span class=o>-&gt;</span><span class=na>recommendationsForUser</span><span class=p>(</span><span class=nv>$user</span><span class=p>);</span>
</span></span></code></pre></div><h3 id=facade class="relative group">Facade <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#facade aria-label=Anchor>#</a></span></h3><p>To achieve this code, we first need a <a href=https://laravel.com/docs/9.x/facades#main-content>Laravel Facade</a>. This Facade
will call the Recommender Manager.</p><blockquote><p>In a Laravel application, a facade is a class that provides access to an object from the container.
The machinery that makes this work is in the Facade class. Laravel&rsquo;s facades, and any custom facades you create,
will extend the base Illuminate\Support\Facades\Facade class.</p></blockquote><p>As so often I recommend to type-hint all methods to utilize autocompletion as well as the possibility to &ldquo;click through&rdquo;
your code easily.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Facades\Facade</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * Class Recommender
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @method recommendationsForUser(array $models, ?int $userId = null)
</span></span></span><span class=line><span class=cl><span class=sd> * @see \App\Support\Drivers\HugoDriver::recommendationsForUser()
</span></span></span><span class=line><span class=cl><span class=sd> * @method driver(string $name)
</span></span></span><span class=line><span class=cl><span class=sd> *
</span></span></span><span class=line><span class=cl><span class=sd> * @see \App\Support\Managers\RecommenderManager
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Recommender</span> <span class=k>extends</span> <span class=nx>Facade</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>getFacadeAccessor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>RecommenderManager</span><span class=o>::</span><span class=na>class</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=manager class="relative group">Manager <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#manager aria-label=Anchor>#</a></span></h3><p>The Manager defines which Driver is initiated. For this extend the <code>Illuminate\Support\Manager</code>. To implement this class
you need to define the method <code>getDefaultDriver</code>. If you want a different default per environment, this would be the
place to either return a config value or an environment variable. Then you need one method per Driver you want to build.
The Illuminate Manager will guess the method name based on the string you put in (e.g. <code>'fake'</code>)
using <code>$method = 'create'.Str::studly($driver).'Driver';</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Manager</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommenderManager</span> <span class=k>extends</span> <span class=nx>Manager</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getDefaultDriver</span><span class=p>()</span><span class=o>:</span> <span class=nx>string</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>env</span><span class=p>(</span><span class=s1>&#39;RECOMMENDER_DRIVER&#39;</span><span class=p>,</span> <span class=s1>&#39;fake&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>createHugoDriver</span><span class=p>()</span><span class=o>:</span> <span class=nx>HugoDriver</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>HugoDriver</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>createFakeDriver</span><span class=p>()</span><span class=o>:</span> <span class=nx>FakeDriver</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>FakeDriver</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>One step is missing until this is working - registering the Manager. This is done using
a <a href=https://laravel.com/docs/9.x/providers>Laravel Service Provider</a>. As I don&rsquo;t plan to use the Recommender
functionality in every request I made it a deferred Provider.</p><blockquote><p>If your provider is only registering bindings in the service container, you may choose to defer its registration until
one of the registered bindings is actually needed. Deferring the loading of such a provider will improve the
performance of your application, since it is not loaded from the filesystem on every request.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\ServiceProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Contracts\Support\DeferrableProvider</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>RecommenderServiceProvider</span> <span class=k>extends</span> <span class=nx>ServiceProvider</span> <span class=k>implements</span> <span class=nx>DeferrableProvider</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>register</span><span class=p>()</span><span class=o>:</span> <span class=nx>void</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>app</span><span class=o>-&gt;</span><span class=na>singleton</span><span class=p>(</span><span class=nx>RecommenderManager</span><span class=o>::</span><span class=na>class</span><span class=p>,</span> <span class=nx>fn</span> <span class=p>(</span><span class=nv>$app</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=k>new</span> <span class=nx>RecommenderManager</span><span class=p>(</span><span class=nv>$app</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>provides</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=nx>RecommenderManager</span><span class=o>::</span><span class=na>class</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=driver class="relative group">Driver <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#driver aria-label=Anchor>#</a></span></h3><p>The Facade calls the Manager, and the Manager decides which Driver to call, now the Driver is missing implementation.
This is very straightforward. Whatever Hugo does, Hugo does it here!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Support\Collection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>HugoDriver</span> <span class=k>implements</span> <span class=nx>RecommenderContract</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>recommendationsForUser</span><span class=p>(</span><span class=k>array</span> <span class=nv>$models</span><span class=p>,</span> <span class=o>?</span><span class=nx>int</span> <span class=nv>$userId</span> <span class=o>=</span> <span class=k>null</span><span class=p>)</span><span class=o>:</span> <span class=nx>Collection</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// implement magic here
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=nx>collect</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=additional class="relative group">Additional <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#additional aria-label=Anchor>#</a></span></h3><p>As I mentioned I use this to test my code if it utilises third-party technology. So when I write a FakeDriver I
implement additional methods, that allow me to fake different states, time delays, or other things. Sure, you can also
write tiny Unit Tests to test such behaviors, I made the best experience with feature tests and this method of faking
data during the tests.</p><h2 id=happy-coding class="relative group">Happy Coding <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#happy-coding aria-label=Anchor>#</a></span></h2><p>This was my two cents on Manager and Drivers, and the way I implemented it. When I discovered the pattern I read through
this <a href=https://itnext.io/building-driver-based-components-in-laravel-5b390dc25bd9>post by Orobo</a>, as well
as <a href=https://inspector.dev/how-to-extend-laravel-with-driver-based-services/>this on by Valerio</a>.</p><p>If you spot an error, please don&rsquo;t hesitate on enlighten me,</p><p>Happy Coding :)</p></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><div class=place-self-center><div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Sofia Fischer</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=mailto:sofia@philodev.com target=_blank aria-label=Email rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.philodev.one target=_blank aria-label=Link rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M172.5 131.1c55.6-55.59 148-55.59 203.6.0 50 50 57.4 129.7 16.3 187.2L391.3 319.9C381 334.2 361 337.6 346.7 327.3c-14.4-10.3-17.8-30.3-7.5-44.6L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2c-31.4-31.4-82.5-31.4-114 0L105.5 289.5c-31.51 30.6-31.51 82.5.0 114C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4 265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2c-58.4 41.1-136.3 34.5-186.29-15.4-56.469-56.5-56.469-148.1.0-204.5L172.5 131.1zM467.5 380c-56.5 56.5-148 56.5-204.5.0-50-50-56.5-128.8-15.4-186.3L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7 307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8c31.4 31.4 82.5 31.4 114 0L534.5 222.5c31.5-31.5 31.5-83.4.0-114C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58 374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24c56.5 56.46 56.5 148.06.0 204.46L467.5 380z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/sofia-fischer target=_blank aria-label=Github rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/sofia-fischer-58b1611b9/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></div></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group" href=/posts/2022-05-relationships/><span class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Useful and Useless Relationship Definitions</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-05-20 14:20:44 +0200 CEST">20 May 2022</time></span></span></a></span>
<span></span></div></div></footer></article><div class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"><a href=#the-top class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2022
Sofia Fischer</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://git.io/hugo-congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"><button id=appearance-switcher class="w-12 h-12" type=button title="Switch to dark appearance">
<span class="inline dark:hidden"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></span><span class="hidden dark:inline"><span class="relative inline-block align-text-bottom icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></span></button></div></div></footer></div></body></html>