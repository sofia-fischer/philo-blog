<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="rgb(255,255,255)"><title>Model Specific Query Builder - an Alternative to Scopes &#183; PhiloBlog</title>
<meta name=title content="Model Specific Query Builder - an Alternative to Scopes &#183; PhiloBlog"><script type=text/javascript src=/js/appearance.min.022d0ebc3b46a335eb1c7ef79b7f2de143d7cd5156d433638592ef1ce5f8554e.js integrity="sha256-Ai0OvDtGozXrHH73m38t4UPXzVFW1DNjhZLvHOX4VU4="></script><link type=text/css rel=stylesheet href=/css/main.bundle.min.da111574272c989ee0d004e7880fe24f819eeaa7cef904fc5623be203611694f.css integrity="sha256-2hEVdCcsmJ7g0ATniA/iT4Ge6qfO+QT8ViO+IDYRaU8="><meta name=description content="
      Scopes are nice, but by extending the Eloquent Builder for a Model enables you to add custom, model-specific methods that are often used or should have a central definition
    "><link rel=canonical href=https://www.blog.philodev.one/posts/2022-05-custom-query-builder-pattern/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta property="og:title" content="Model Specific Query Builder - an Alternative to Scopes"><meta property="og:description" content="Scopes are nice, but by extending the Eloquent Builder for a Model enables you to add custom, model-specific methods that are often used or should have a central definition"><meta property="og:type" content="article"><meta property="og:url" content="https://www.blog.philodev.one/posts/2022-05-custom-query-builder-pattern/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-14T08:20:44+02:00"><meta property="article:modified_time" content="2022-05-14T08:20:44+02:00"><meta property="og:site_name" content="Philodev Blog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Model Specific Query Builder - an Alternative to Scopes"><meta name=twitter:description content="Scopes are nice, but by extending the Eloquent Builder for a Model enables you to add custom, model-specific methods that are often used or should have a central definition"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Model Specific Query Builder - an Alternative to Scopes","headline":"Model Specific Query Builder - an Alternative to Scopes","description":"Scopes are nice, but by extending the Eloquent Builder for a Model enables you to add custom, model-specific methods that are often used or should have a central definition","abstract":"Scopes are nice, but by extending the Eloquent Builder for a Model enables you to add custom, model-specific methods that are often used or should have a central definition Scopes are great, but \u0026hellip; #Local scopes allow you to define common sets of query constraints that you may easily re-use throughout your application; read more in the Laravel Docs.","inLanguage":"en","url":"https:\/\/www.blog.philodev.one\/posts\/2022-05-custom-query-builder-pattern\/","author":{"@type":"Person","name":""},"copyrightYear":"2022","dateCreated":"2022-05-14T08:20:44\u002b02:00","datePublished":"2022-05-14T08:20:44\u002b02:00","dateModified":"2022-05-14T08:20:44\u002b02:00","keywords":["Development","Software Pattern","Laravel"],"mainEntityOfPage":"true","wordCount":"1078"}</script></head><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold pe-2 text-primary-600 dark:text-primary-400">&darr;</span>Skip to main content</a></div><header class="py-6 font-semibold text-neutral-900 dark:text-neutral print:hidden sm:py-10"><nav class="flex items-start justify-between sm:items-center"><div class="flex flex-row items-center"><a href=/ class=mr-2><img src=/logo.png width=1012 height=1012 class="max-h-[10rem] max-w-[10rem] object-scale-down object-left" alt=PhiloBlog>
</a><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2" rel=me href=/>PhiloBlog</a></div><ul class="flex flex-col list-none text-end sm:flex-row"><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/posts/ title=Posts><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Blog</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=https://www.philodev.one title><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">About Philodev</span></a></li><li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5"><a href=/tags/ title=Tags><span class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2">Tags</span></a></li></ul></nav></header><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header class=max-w-prose><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>PhiloBlog</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class="inline hidden"><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/posts/2022-05-custom-query-builder-pattern/>Model Specific Query Builder - an Alternative to Scopes</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Model Specific Query Builder - an Alternative to Scopes</h1><div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-05-14 08:20:44 +0200 CEST">14 May 2022</time><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">6 mins</span></div></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first px-0 lg:order-last lg:max-w-xs lg:ps-8"><div class="toc pe-5 print:hidden lg:sticky lg:top-10"><details open class="-ms-5 mt-0 overflow-hidden rounded-lg ps-5"><summary class="-ms-5 block cursor-pointer bg-neutral-100 py-1 ps-5 text-lg font-semibold text-neutral-800 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="-ms-5 border-s border-dotted border-neutral-300 py-2 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><ul><li><a href=#scopes-are-great-but->Scopes are great, but &mldr;</a></li><li><a href=#about-patterns>About Patterns</a><ul><li><a href=#repository-pattern>Repository Pattern</a></li></ul></li><li><a href=#writing-a-custom-builder-that-extends-the-eloquent-builder>Writing a Custom Builder that Extends the Eloquent Builder</a></li><li><a href=#enjoy-the-usage>Enjoy the Usage</a></li><li><a href=#bonus>Bonus:</a></li><li><a href=#bonus-hin-custom-collections>Bonus hin: custom Collections</a></li></ul></li></ul></nav></div></details></div></div><div class="min-w-0 min-h-0 max-w-prose grow"><div class="lead !mb-9 text-xl">Scopes are nice, but by extending the Eloquent Builder for a Model enables you to add custom,
model-specific methods that are often used or should have a central definition</div><h2 id=scopes-are-great-but- class="relative group">Scopes are great, but &mldr; <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#scopes-are-great-but- aria-label=Anchor>#</a></span></h2><p>Local scopes allow you to define common sets of query constraints that you may easily re-use throughout your
application; read more in <a href=https://laravel.com/docs/9.x/eloquent#local-scopes target=_blank rel=noreferrer>the Laravel Docs</a>. Also, if you want to
have a definition of a scope in one central place to maybe come back and change in at one place, instead of everywhere -
a common example in practise is an <code>activeUser</code> scope (email confirmed? password not older than one year? &mldr; ).</p><p>Scopes are great, but have two major drawbacks from my point of view: #1 no autocompletion / no &ldquo;jump in your code by
clicking&rdquo; on it, no type hinting. This is because drawback #2 they are executed by Laravel magics. The Framework checks
if the method you are trying to call is defined in <code>scope&lt;yourMethodNameInCamelCase></code> in the model and uses it then.</p><h2 id=about-patterns class="relative group">About Patterns <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#about-patterns aria-label=Anchor>#</a></span></h2><p>Laravel Scopes are build utilizing the <strong>Builder Pattern</strong>, which enables the build-up of complex object (in this case
the object representation of a SQL Query) step by step using methods to change the query bit by bit. Now, scopes are
also following the pattern but in use cases in which a set of queries if performed often, they make the code more
readable and maintainable.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><h3 id=repository-pattern class="relative group">Repository Pattern <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#repository-pattern aria-label=Anchor>#</a></span></h3><p>One pattern is partially similar, the Repository Pattern was the closest I could find. Most times the Repository handles
create, delete, and index methods, while this post focuses on index / query methods only. The only I could not find a
specific Pattern I could match the custom query builder with, but</p><p>The Repository is an abstraction Layer of Data, from this abstraction Layer the data may be retrieved using function
like <code>Post::getAll()</code> or in the case of Eloquent <code>Post::all()</code>. Most implementations of the Repository pattern I found
are doing the above step of overwriting Eloquent methods with their own <code>getAll</code> method. But instead of overwriting the
Eloquent methods, why not just extend them? <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></p><h2 id=writing-a-custom-builder-that-extends-the-eloquent-builder class="relative group">Writing a Custom Builder that Extends the Eloquent Builder <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#writing-a-custom-builder-that-extends-the-eloquent-builder aria-label=Anchor>#</a></span></h2><p>The Builder that Laravel uses behind every <code>::query()</code> is the <code>Illuminate\Database\Eloquent\Builder</code>. A class that
extends this Builder for one Model offers the opportunity to add custom methods to the Builder.</p><p>Compared to Scopes I want to highlight, that neither the Scope Prefix is needed, nor the $query parameter. Additionally,
this utilises the fully typed / auto-completion feature I value so much <sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=nx>App\Models\Builders</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>App\Models\User</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Database\Eloquent\Builder</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * @template TModelClass of \App\Models\Post
</span></span></span><span class=line><span class=cl><span class=sd> * @extends Builder&lt;TModelClass&gt;
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PostBuilder</span> <span class=k>extends</span> <span class=nx>Builder</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>published</span><span class=p>()</span><span class=o>:</span> <span class=nx>self</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;published&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>whereHasMedia</span><span class=p>()</span><span class=o>:</span> <span class=nx>self</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=nx>fn</span> <span class=p>(</span><span class=nx>self</span> <span class=nv>$query</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$query</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>whereHas</span><span class=p>(</span><span class=s1>&#39;image&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>orWhereHas</span><span class=p>(</span><span class=s1>&#39;video&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>visibleToUser</span><span class=p>(</span><span class=nx>User</span> <span class=nv>$user</span><span class=p>)</span><span class=o>:</span> <span class=nx>self</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>published</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=nx>fn</span> <span class=p>(</span><span class=nx>PostBuilder</span> <span class=nv>$query</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$query</span>
</span></span><span class=line><span class=cl>                <span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;privacy&#39;</span><span class=p>,</span> <span class=s1>&#39;public&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=o>-&gt;</span><span class=na>when</span><span class=p>(</span><span class=nv>$user</span><span class=o>-&gt;</span><span class=na>isAdmin</span><span class=p>(),</span> <span class=nx>fn</span> <span class=p>(</span><span class=nx>PostBuilder</span> <span class=nv>$query</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$query</span>
</span></span><span class=line><span class=cl>                    <span class=o>-&gt;</span><span class=na>orWhere</span><span class=p>(</span><span class=s1>&#39;privacy&#39;</span><span class=p>,</span> <span class=s1>&#39;friends&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This will not work out of the box, how should Laravel know that we don&rsquo;t want to use the Eloquent Buidler?</p><p>To solve this we first have to overwrite the <code>query</code> Method to get the Typehints and autocompletion. Secondly we have to
overwrite the Model <code>newEloquentBuilder</code> method. Inside the <code>Illuminate\Database\Eloquent\Model</code> this methods usually
initiates a new <code>\Illuminate\Database\Query\Builder</code> using the <code>$query</code> parameter. As our <code>PostBuilder</code> extends this
Class, we can just use it the same.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Post</span> <span class=k>extends</span> <span class=nx>Model</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @return PostBuilder&lt;\App\Models\Post&gt;
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>static</span> <span class=k>function</span> <span class=nf>query</span><span class=p>()</span><span class=o>:</span> <span class=nx>PostBuilder</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>parent</span><span class=o>::</span><span class=na>query</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @param \Illuminate\Database\Query\Builder $query
</span></span></span><span class=line><span class=cl><span class=sd>     * @return PostBuilder&lt;\App\Models\Post&gt;
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>newEloquentBuilder</span><span class=p>(</span><span class=nv>$query</span><span class=p>)</span><span class=o>:</span> <span class=nx>PostBuilder</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>PostBuilder</span><span class=p>(</span><span class=nv>$query</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>...</span>
</span></span></code></pre></div><h2 id=enjoy-the-usage class="relative group">Enjoy the Usage <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#enjoy-the-usage aria-label=Anchor>#</a></span></h2><p>Let&rsquo;s feel the joy of what we have implemented:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$posts</span> <span class=o>=</span> <span class=nx>Post</span><span class=o>::</span><span class=na>query</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>visibleToUser</span><span class=p>(</span><span class=nx>Auth</span><span class=o>::</span><span class=na>user</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>paginate</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$latestPostedImage</span> <span class=o>=</span> <span class=nx>Post</span><span class=o>::</span><span class=na>query</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>where</span><span class=p>(</span><span class=s1>&#39;user_id&#39;</span><span class=p>,</span> <span class=mi>41</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>whereHasMedia</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>published</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>latest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>first</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$latestPostedImage</span> <span class=o>=</span> <span class=nv>$user</span><span class=o>-&gt;</span><span class=na>posts</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>published</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>first</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$userWithPublishedPosts</span> <span class=o>=</span> <span class=nx>User</span><span class=o>::</span><span class=na>query</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>whereHas</span><span class=p>(</span><span class=s1>&#39;post&#39;</span><span class=p>,</span> <span class=nx>fn</span> <span class=p>(</span><span class=nx>PostBuilder</span> <span class=nv>$query</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$query</span><span class=o>-&gt;</span><span class=na>published</span><span class=p>(</span><span class=nv>$user</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=o>-&gt;</span><span class=na>get</span><span class=p>();</span>
</span></span></code></pre></div><p>Can you feel it? No, you can&rsquo;t - you have to try it to get the satisfying feeling of your IDE proposing the
Model-dependent extra methods like &lsquo;published&rsquo; while typing, or when you go through old or unknown code the possibility
to click on the method and get directly to the implementation without any Laravel Plugin or searching for a ScopeMethod.</p><p>There a some additional things to mention:</p><ul><li>If you don&rsquo;t use the <code>query</code> Method (like <code>Post::first()</code>) the <code>newEloquentBuilder</code> Method will be called anyway, but
you don&rsquo;t have Typehints</li><li>Usage of the two patterns are the same, the main different is the way ScopeMethods are implemented and the two extra
Methods in the Model</li><li>In case your super high complexity Project can utilize it: Builder classes may share traits ;)</li></ul><h2 id=bonus class="relative group">Bonus: <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bonus aria-label=Anchor>#</a></span></h2><p>If custom query builders is not enough for you to play with, try customising Collections <sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>. If there
is any set of collection methods you always use, or you are missing, you can just extend the Laravel Collections
yourself!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>AppServiceProvider</span> <span class=k>extends</span> <span class=nx>ServiceProvider</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>boot</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Collection</span><span class=o>::</span><span class=na>macro</span><span class=p>(</span><span class=s1>&#39;firstWhereMin&#39;</span><span class=p>,</span> <span class=nx>fn</span> <span class=p>(</span><span class=nx>string</span> <span class=nv>$key</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>firstWhere</span><span class=p>(</span><span class=nv>$key</span><span class=p>,</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>min</span><span class=p>(</span><span class=nv>$key</span><span class=p>)));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>I am still looking for a nice way to keep my beloved autocompletion, but for just the functionality I can recommend you
to just write all the Collection methods you might miss. <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></p><h2 id=bonus-hin-custom-collections class="relative group">Bonus hin: custom Collections <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#bonus-hin-custom-collections aria-label=Anchor>#</a></span></h2><p>Next to the custom query builder, Laravel allows to also have customized the collections that get instntiated when e.g.
a HasMany Relation is called without brackets or a query is call using <code>get()</code>. <sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>use</span> <span class=nx>Illuminate\Database\Eloquent\Collection</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PostCollection</span> <span class=k>extends</span> <span class=nx>Collection</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>published</span><span class=p>()</span><span class=o>:</span> <span class=nx>self</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>filter</span><span class=p>(</span><span class=nx>fn</span> <span class=p>(</span><span class=nx>Post</span> <span class=nv>$post</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nv>$post</span><span class=o>-&gt;</span><span class=na>published_at</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Post</span> <span class=k>extends</span> <span class=nx>Model</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>newCollection</span><span class=p>(</span><span class=k>array</span> <span class=nv>$models</span> <span class=o>=</span> <span class=p>[])</span><span class=o>:</span> <span class=nx>PostCollection</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=nx>PostCollection</span><span class=p>(</span><span class=nv>$models</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>In
<a href=https://www.blog.philodev.one/posts/2022-05-driver-manager-pattern/>this post</a> I write more about
patterns&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>In my personal point of view the only reason to completely implement this pattern is to generate
everything starting from routes, to controller, and resources based on an openApi file or so,
but <a href=https://laravelarticle.com/repository-design-pattern-in-laravel target=_blank rel=noreferrer>here is an example</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>When I looked through the web, the only blog articles I could find, which did implement this pattern
where <a href=https://martinjoo.dev/build-your-own-laravel-query-builders target=_blank rel=noreferrer>this one by Martin Joo</a>
and <a href=https://timacdonald.me/dedicated-eloquent-model-query-builders/ target=_blank rel=noreferrer>this one by Tim MacDonald</a>. Both do not overwrite
the query method, but every thing else is quite similar to this post.&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>Read through the <a href=https://laravel.com/docs/9.x/collections#extending-collections target=_blank rel=noreferrer>Laravel Docs</a>
regarding this&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://github.com/spatie/laravel-collection-macros target=_blank rel=noreferrer>Spatie has a package</a> with nice examples if
you are looking for something pre-build or inspiration&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>Found in this book which refers to quite some topics I like: LARAVEL BEYOND CRUD by Brent Roose&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=flex><div class=place-self-center><div class="text-2xl sm:text-lg"></div></div></div><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="group flex" href=/posts/2022-05-demo-env/><span class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&larr;</span><span class="ltr:hidden rtl:inline">&rarr;</span></span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Demo Environments and what I learned from implementing one</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-05-11 20:36:22 +0200 CEST">11 May 2022</time>
</span></span></a></span><span><a class="group flex text-right" href=/posts/2022-05-relationships/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Useful and Useless Relationship Definitions</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2022-05-20 14:20:44 +0200 CEST">20 May 2022</time>
</span></span><span class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"><span class="ltr:inline rtl:hidden">&rarr;</span><span class="ltr:hidden rtl:inline">&larr;</span></span></a></span></div></div></footer></article><div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer class="py-10 print:hidden"><div class="flex items-center justify-between"><div><p class="text-sm text-neutral-500 dark:text-neutral-400">&copy;
2023</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://github.com/jpanther/congo target=_blank rel="noopener noreferrer">Congo</a></p></div><div class="flex flex-row items-center"><div class="me-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"><button id=appearance-switcher-0 type=button aria-label="appearance switcher"><div class="flex items-center justify-center w-12 h-12 dark:hidden" title="Switch to dark appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden w-12 h-12 dark:flex" title="Switch to light appearance"><span class="relative inline-block align-text-bottom px-1 icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div></div></footer></div></body></html>